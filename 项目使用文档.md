# Boss助手 - AI自动化智能体

> 一个基于豆包 AI 的 Android 智能助手应用，支持离线语音识别、自然语言任务自动化执行

## 📱 应用简介

Boss助手（AIAutomation）是一款智能的 Android 自动化助手应用，通过自然语言描述任务，AI 会自动分析屏幕内容并执行相应操作。支持离线中文语音输入，让操作更加便捷。

### 核心特性

- 🎤 **离线语音识别** - 集成 Vosk 引擎，支持中文语音转文字，无需联网
- 💬 **聊天式交互** - 通过对话方式描述任务，AI 自动理解并执行
- 🤖 **智能自动化** - AI 分析屏幕内容，自动执行点击、输入、滑动等操作
- 📝 **聊天记录保存** - 自动保存对话历史，关闭应用后不丢失
- 🎯 **任务完成通知** - 任务完成后弹窗提示，可复制结果
- 🔄 **快捷重试** - 点击消息上的刷新按钮可快速重新执行任务
- 🎨 **现代化 UI** - Material Design 3 设计，流畅的动画效果

## 🚀 快速开始

### 首次使用

1. **安装应用**
   - 下载 APK 文件: `app/build/outputs/apk/debug/app-debug.apk`
   - 安装到手机（需允许安装未知来源应用）

2. **授予权限**
   - 录音权限：首次使用语音输入时会请求
   - 无障碍权限：进入系统设置 → 无障碍 → 启用 "AI自动化助手"
   - 悬浮窗权限：Android 6.0+ 需要在设置中授权

3. **开始使用**
   - 打开应用，点击底部输入框
   - 输入或语音描述任务，例如：
     - "打开淘宝搜索手机"
     - "查看今天的天气"
     - "在抖音点赞前5个视频"
   - 点击发送，AI 会自动执行任务

### 语音输入使用

#### 方式一：按住说话（推荐）
1. **按住**输入框旁边的麦克风图标 🎤
2. 开始说话
3. **松开**自动停止并填入文字

#### 方式二：点击录音
1. **点击**麦克风图标开始录音
2. 说话时实时显示识别结果
3. 说完后再次点击停止

> 💡 提示：首次启动会加载语音模型（约3-5秒），完成后会提示"语音识别已就绪"

## 📚 功能详解

### 1. 聊天界面

**主要功能：**
- 对话气泡显示用户输入和 AI 回复
- 自动保存聊天历史（关闭应用后不丢失）
- 点击消息上的刷新图标可快速重试任务
- 点击清空按钮清除所有聊天记录

**支持操作：**
- 输入文字或使用语音描述任务
- 查看 AI 执行进度和结果
- 任务完成后会弹出完成对话框
- 可复制任务执行结果

### 2. 任务完成通知

任务执行完成后会：
1. 自动切换到应用前台
2. 弹出任务完成对话框，显示：
   - ✅ 绿色完成图标
   - 详细的执行结果
   - 复制按钮（一键复制结果）
   - 返回按钮（关闭对话框）

### 3. 悬浮窗控制

任务执行时会显示悬浮窗，提供：
- **实时状态显示** - 当前执行步骤
- **AI 推理过程** - 显示 AI 的思考内容（透明度 50%）
- **可拖动** - 拖动到屏幕任意位置
- **控制按钮**：
  - 暂停/继续
  - 停止任务
  - 隐藏悬浮窗

### 4. 设置选项

在用户界面（底部右侧图标）可访问设置：
- 📍 **显示操作坐标** - 调试模式，显示点击坐标（开发用）
- 🔧 其他系统设置

## 🎙️ 语音识别说明

### 技术方案
- **引擎**: Vosk（开源离线方案）
- **语言**: 中文
- **模型**: vosk-model-small-cn-0.22 (42MB)
- **特点**: 完全免费、离线运行、隐私安全

### 识别准确率
- 日常对话: 85-90%
- 简单指令: 90%+
- 专业术语: 可能较低

### 使用建议
- ✅ 清晰发音，语速适中
- ✅ 安静环境，减少背景噪音
- ✅ 手机距离嘴巴 20-30cm
- ✅ 长句子可分段识别

### 隐私保证
- 所有语音识别在本地完成
- 不上传任何音频数据
- 不收集语音内容

## 🏗️ 技术架构

### 技术栈
- **开发语言**: Kotlin
- **UI 框架**: Jetpack Compose + Material Design 3
- **数据库**: Room + SharedPreferences
- **网络**: OkHttp + Gson
- **异步**: Kotlin Coroutines + Flow
- **语音识别**: Vosk (离线中文模型)
- **AI 引擎**: 豆包 Context API
- **系统服务**: Accessibility Service
- **最小 SDK**: 26 (Android 8.0)
- **目标 SDK**: 34 (Android 14)

### 核心模块

#### 1. AI 客户端 (`ai/DoubaoApiClient.kt`)
- 封装豆包 Context API 调用
- 支持上下文对话管理
- 自动处理 API 认证和错误

#### 2. 语音识别 (`voice/VoiceRecognizer.kt`)
- Vosk 离线语音识别引擎
- 实时语音转文字
- 中文空格自动移除
- 按住说话/点击录音两种模式

#### 3. 无障碍服务 (`service/MyAccessibilityService.kt`)
- 屏幕内容抓取和解析
- 元素查找和操作
- 支持点击、输入、手势操作

#### 4. 任务管理器 (`automation/TaskManager.kt`)
- AI 驱动的自动化执行引擎
- 智能决策系统
- 动作解析和执行
- 进度回调和状态管理

#### 5. 数据层
- **聊天历史**: SharedPreferences (JSON 格式)
- **应用设置**: SharedPreferences (AppSettings)
- **数据模型**: Task, Action, ChatMessage

#### 6. UI 界面
- **NewMainActivity**: 主界面（HOME 和 USER 两个标签）
- **HomeScreen**: 主页聊天界面
- **UserScreen**: 用户设置界面
- **ChatActivity**: 独立聊天窗口（备用）
- **TaskCompletionDialog**: 任务完成对话框

### AI 工作原理

```
1. 用户输入任务 → 2. 创建 AI Context
                     ↓
5. 任务完成通知 ← 4. 执行操作（点击/输入/滑动）
                     ↓
                  3. AI 分析屏幕并决策下一步
                     ↓
                  重复步骤 2-4 直到完成
```

**支持的动作类型：**
- **点击**: 通过元素描述或坐标点击
- **输入**: 在指定输入框中输入文本
- **滑动**: 手势操作
- **等待**: 延迟执行
- **完成**: 标记任务完成并返回结果

## 📖 项目结构

```
AIAutomation/
├── app/
│   ├── build.gradle.kts              # 应用构建配置
│   └── src/main/
│       ├── AndroidManifest.xml       # 应用清单
│       ├── assets/
│       │   └── model-cn/             # Vosk 中文语音模型
│       ├── java/com/aiautomation/
│       │   ├── ai/                   # AI 客户端
│       │   │   └── DoubaoApiClient.kt
│       │   ├── automation/           # 自动化引擎
│       │   │   └── TaskManager.kt
│       │   ├── data/
│       │   │   └── model/            # 数据模型
│       │   │       ├── Task.kt
│       │   │       └── Action.kt
│       │   ├── service/              # 系统服务
│       │   │   ├── MyAccessibilityService.kt
│       │   │   └── FloatWindowManager.kt
│       │   ├── settings/             # 应用设置
│       │   │   └── AppSettings.kt
│       │   ├── ui/                   # UI 界面
│       │   │   ├── NewMainActivity.kt
│       │   │   ├── ChatActivity.kt
│       │   │   ├── HomeScreen.kt
│       │   │   ├── LibraryAndUserScreens.kt
│       │   │   └── theme/
│       │   └── voice/                # 语音识别
│       │       └── VoiceRecognizer.kt
│       ├── res/
│       │   ├── layout/
│       │   │   └── layout_easy_float.xml  # 悬浮窗布局
│       │   ├── mipmap-*/             # 应用图标
│       │   ├── values/               # 资源文件
│       │   └── xml/
│       │       └── accessibility_service_config.xml
│       └── ...
├── gradle/                           # Gradle Wrapper
├── build.gradle.kts                  # 项目构建配置
├── settings.gradle.kts               # 项目设置
└── 项目使用文档.md                    # 本文档
```

## 🔧 开发说明

### 编译项目

```bash
# 清理项目
./gradlew clean

# 编译 Debug 版本
./gradlew assembleDebug

# 编译 Release 版本
./gradlew assembleRelease

# 安装到设备
./gradlew installDebug
```

### 依赖配置

主要依赖库：
```gradle
// Jetpack Compose
implementation("androidx.compose.ui:ui:1.5.4")
implementation("androidx.compose.material3:material3:1.1.2")

// Vosk 语音识别
implementation("com.alphacephei:vosk-android:0.3.32")
implementation("net.java.dev.jna:jna:5.13.0@aar")

// 网络
implementation("com.squareup.okhttp3:okhttp:4.12.0")
implementation("com.google.code.gson:gson:2.10.1")

// EasyFloat 悬浮窗
implementation("com.github.princekin-f:EasyFloat:2.0.4")
```

### API 配置

应用已预配置豆包 AI API：
- API Key: `a05834e0-a6ab-44c4-b531-f9da83f24797`
- Model ID: `ep-20241226105510-hlhgz`

> ⚠️ 注意：该 API Key 仅供测试使用，生产环境请替换为自己的密钥

### 升级语音模型

如需更高准确率，可替换为大型模型：
1. 访问 https://alphacephei.com/vosk/models
2. 下载 `vosk-model-cn-0.22.zip` (255MB)
3. 解压后重命名为 `model-cn`
4. 替换 `app/src/main/assets/model-cn` 目录
5. 重新编译应用

## ❓ 常见问题

### Q: 为什么首次启动较慢？
A: 需要从 assets 解压语音模型文件（42MB），仅首次运行时需要，后续启动会快很多。

### Q: 语音识别准确率如何提高？
A: 
- 保持安静环境
- 吐字清晰，语速适中
- 手机距离适当（20-30cm）
- 可升级到大型模型提高准确率

### Q: 无障碍服务为什么必须开启？
A: 应用需要通过无障碍服务来读取屏幕内容和执行自动化操作，这是 Android 系统对自动化应用的权限要求。

### Q: 任务执行失败怎么办？
A: 
1. 检查无障碍权限是否开启
2. 检查网络连接是否正常
3. 尝试更清晰地描述任务
4. 查看悬浮窗的 AI 推理过程，了解失败原因

### Q: 聊天记录能导出吗？
A: 当前版本聊天记录保存在本地，可以通过清空按钮清除，暂不支持导出功能。

### Q: 支持哪些应用的自动化？
A: 理论上支持所有应用，但实际效果取决于：
- 应用的界面结构
- 元素的可访问性
- 任务的复杂度

## 🎯 更新日志

### v1.0.0 (2024-12-28)
- ✅ 集成 Vosk 离线中文语音识别
- ✅ 实现按住说话和点击录音两种模式
- ✅ UI 全面中文化
- ✅ 实现聊天记录持久化（SharedPreferences）
- ✅ 添加任务完成弹窗通知
- ✅ 添加快捷重试功能
- ✅ 优化悬浮窗显示（透明度、大小、AI 推理过程）
- ✅ 重新设计现代化 App 图标
- ✅ 添加显示操作坐标设置项（调试用）

### 初始版本 (2024-12-26)
- ✅ 基础聊天界面
- ✅ 豆包 AI 集成
- ✅ 无障碍服务实现
- ✅ 悬浮窗控制
- ✅ Material Design 3 UI

## 📄 许可证

本项目仅供学习和研究使用。

## 🔗 参考资源

- [豆包 AI 官方文档](https://www.volcengine.com/docs/82379)
- [Vosk 语音识别](https://alphacephei.com/vosk/)
- [Android Accessibility 开发指南](https://developer.android.com/guide/topics/ui/accessibility)
- [Jetpack Compose 文档](https://developer.android.com/jetpack/compose)

---

**构建时间**: 2024-12-28  
**版本**: 1.0.0  
**构建状态**: ✅ BUILD SUCCESSFUL  
**APK 大小**: ~15 MB
